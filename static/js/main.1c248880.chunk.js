(this["webpackJsonpapollo-music-share"]=this["webpackJsonpapollo-music-share"]||[]).push([[0],{137:function(e,t,n){e.exports=n(175)},175:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(18),l=n.n(i),o=n(16),u=n(205),c=(n(208),n(209),n(129));n(123),Object(u.a)((function(e){return{title:{marginLeft:e.spacing(2)}}}));var s=n(25),m=n(210),d=n(238),p=n(211),g=n(212),b=n(19),f=n(38);function h(){var e=Object(f.a)(["\nquery getQueuedSongs {\n    queue @client {\n        id\n        duration\n        title\n        artist\n        thumbnail\n        url\n    }\n}\n"]);return h=function(){return e},e}var v=Object(b.gql)(h());function y(){var e=Object(f.a)(["\nmutation addSong($title: String!, $artist: String!, $thumbnail: String!, $duration: Float!, $url: String!) {\n    insert_songs(objects: {url: $url, title: $title, thumbnail: $thumbnail, duration: $duration, artist: $artist}) {\n      affected_rows\n    }\n  }\n"]);return y=function(){return e},e}function O(){var e=Object(f.a)(["\nmutation addOrRemoveFromQueue($input: SongInput!){\n  addOrRemoveFromQueue(input: $input) @client\n}\n"]);return O=function(){return e},e}var E=Object(b.gql)(O()),j=Object(b.gql)(y());var S=Object(u.a)({avatar:{width:44,height:44},text:{textOverflow:"ellipsis",overflow:"hidden"},container:{display:"grid",gridAutoFlow:"column",gridTemplateColumns:"50px auto 50px",gridGap:12,alignItems:"center",marginTop:10},songInfoContainer:{overflow:"hidden",whiteSpace:"nowrap"}});function x(e){var t=e.song,n=t.title,a=t.artist,i=t.thumbnail,l=S(),u=Object(b.useMutation)(E,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),m=Object(o.a)(u,1)[0];return r.a.createElement("div",{className:l.container},r.a.createElement(d.a,{src:i,className:l.avatar}),r.a.createElement("div",{className:l.songInfoContainer},r.a.createElement(c.a,{className:l.text,variant:"subtitle2"},n),r.a.createElement(c.a,{className:l.text,color:"textSecondary",variant:"body2"},a)),r.a.createElement(p.a,{onClick:function(){m({variables:{input:Object(s.a)(Object(s.a)({},t),{},{__typename:"Song"})}})}},r.a.createElement(g.a,{color:"error"})))}var N=function(e){var t=e.queue;return Object(m.a)((function(e){return e.breakpoints.up("md")}))&&r.a.createElement("div",{style:{margin:"10px 0"}},r.a.createElement(c.a,{color:"textSecondary",variant:"button"},"QUEUE (",t.length,")"),t.map((function(e){return r.a.createElement(x,{key:e.id,song:e})})))},w=n(213),C=n(214),q=n(239),I=n(219),k=n(215),P=n(216),_=n(217),F=n(218),A=n(80),Q=n.n(A);var T=function(e,t){switch(t.type){case"PLAY_SONG":return Object(s.a)(Object(s.a)({},e),{},{isPlaying:!0});case"PAUSE_SONG":return Object(s.a)(Object(s.a)({},e),{},{isPlaying:!1});case"SET_SONG":return Object(s.a)(Object(s.a)({},e),{},{song:t.payload.song});default:return e}},G=Object(u.a)((function(e){return{container:{display:"flex",justifyContent:"space-between"},details:{display:"flex",flexDirection:"column",padding:"0px 15px"},content:{flex:"1 0 auto"},thumbnail:{width:150},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},playIcon:{height:38,width:38}}}));var $=function(){var e=Object(b.useQuery)(v).data,t=Object(a.useRef)(),n=Object(a.useContext)(ge),i=n.state,l=n.dispatch,u=G(),s=Object(a.useState)(0),m=Object(o.a)(s,2),d=m[0],g=m[1],f=Object(a.useState)(0),h=Object(o.a)(f,2),y=h[0],O=h[1],E=Object(a.useState)(!1),j=Object(o.a)(E,2),S=j[0],x=j[1],A=Object(a.useState)(0),T=Object(o.a)(A,2),$=T[0],M=T[1];return Object(a.useEffect)((function(){var t=e.queue.findIndex((function(e){return e.id===i.song.id}));M(t)}),[e.queue,i.song.id]),console.log(e.queue),Object(a.useEffect)((function(){var t=e.queue[$+1];1===d&&t&&(g(0),l({type:"SET_SONG",payload:{song:t}}))}),[e.queue,d,l,$]),r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{variant:"outlined",className:u.container},r.a.createElement("div",{className:u.details},r.a.createElement(C.a,{className:u.content},r.a.createElement(c.a,{variant:"h5",component:"h3"},i.song.title),r.a.createElement(c.a,{variant:"subtitle1",component:"p",color:"textSecondary"},i.song.title)),r.a.createElement("div",{className:u.controls},r.a.createElement(p.a,{onClick:function(){var t=e.queue[$-1];t&&l({type:"SET_SONG",payload:{song:t}})}},r.a.createElement(k.a,null)),r.a.createElement(p.a,{onClick:function(){l(i.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})}},i.isPlaying?r.a.createElement(P.a,{className:u.playIcon}):r.a.createElement(_.a,{className:u.playIcon})),r.a.createElement(p.a,{onClick:function(){var t=e.queue[$+1];t&&l({type:"SET_SONG",payload:{song:t}})}},r.a.createElement(F.a,null)),r.a.createElement(c.a,{variant:"subtitle1",component:"p",color:"textSecondary"},new Date(1e3*y).toISOString().substr(11,8))),r.a.createElement(q.a,{onMouseDown:function(){x(!0)},onMouseUp:function(){x(!1),t.current.seekTo(d)},onChange:function(e,t){g(t)},value:d,type:"range",min:0,max:1,step:.01})),r.a.createElement(Q.a,{ref:t,onProgress:function(e){var t=e.played,n=e.playedSeconds;S||(g(t),O(n))},url:i.song.url,playing:i.isPlaying,hidden:!0}),r.a.createElement(I.a,{className:u.thumbnail,image:i.song.thumbnail})),r.a.createElement(N,{queue:e.queue}))},M=n(220),R=n(221),D=n(222);function L(){var e=Object(f.a)(["\nsubscription getSongs {\n    songs(order_by: {created_at: desc}){\n        artist\n        duration\n        id\n        thumbnail\n        title\n        url\n    }\n  }\n"]);return L=function(){return e},e}var U=Object(b.gql)(L());var B=Object(u.a)((function(e){return{container:{margin:e.spacing()},songInfoContainer:{display:"flex",alignItems:"center"},songInfo:{width:"100%",display:"flex",justifyContent:"space-between"},thumbnail:{objectFit:"cover",width:140,height:140}}}));function J(e){var t=e.song,n=t.title,i=t.artist,l=t.thumbnail,u=t.id,m=Object(a.useState)(!1),d=Object(o.a)(m,2),g=d[0],f=d[1],h=Object(a.useContext)(ge),v=h.state,y=h.dispatch,O=Object(b.useMutation)(E,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),j=Object(o.a)(O,1)[0];Object(a.useEffect)((function(){var e=v.isPlaying&&u===v.song.id;f(e)}),[u,v.isPlaying,v.song.id]);var S=B();return r.a.createElement(w.a,{className:S.container},r.a.createElement("div",{className:S.songInfoContainer},r.a.createElement(I.a,{className:S.thumbnail,image:l.replace("http","https")}),r.a.createElement("div",{className:S.songInfo},r.a.createElement(C.a,null,r.a.createElement(c.a,{gutterBottom:!0,variant:"h5",component:"h2"},n),r.a.createElement(c.a,{variant:"body1",component:"p",color:"textSecondary"},i)),r.a.createElement(R.a,null,r.a.createElement(p.a,{onClick:function(){y({type:"SET_SONG",payload:{song:t}}),y(v.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},size:"small",color:"primary"},g?r.a.createElement(P.a,null):r.a.createElement(_.a,null)),r.a.createElement(p.a,{onClick:function(){j({variables:{input:Object(s.a)(Object(s.a)({},t),{},{__typename:"Song"})}})},size:"small",color:"secondary"},r.a.createElement(D.a,{color:"secondary"}))))))}var W=function(){var e=Object(b.useSubscription)(U),t=e.data,n=e.loading,a=e.error;return n?r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:50}},r.a.createElement(M.a,null)):a?r.a.createElement("div",null,"Error fetching songs"):r.a.createElement("div",null,t.songs.map((function(e){return r.a.createElement(J,{key:e.id,song:e})})))},Y=n(63),z=n.n(Y),V=n(24),Z=n(91),H=n(237),K=n(223),X=n(224),ee=n(235),te=n(225),ne=n(226),ae=n(227),re=n(228),ie=n(229),le=n(90),oe=n.n(le),ue=n(89),ce=n.n(ue),se=Object(u.a)((function(e){return{container:{display:"flex",alignItems:"center"},urLInput:{margin:e.spacing(1)},addSongButton:{margin:e.spacing(1)},dialog:{textAlign:"center"},thumbnail:{width:"90%"}}})),me={duration:0,title:"",artist:"",thumbnail:""};var de=function(){var e=Object(a.useState)(""),t=Object(o.a)(e,2),n=t[0],i=t[1],l=Object(b.useMutation)(j),u=Object(o.a)(l,2),c=u[0],m=u[1].error,d=Object(a.useState)(!1),p=Object(o.a)(d,2),g=p[0],f=p[1],h=se(),v=Object(a.useState)(!1),y=Object(o.a)(v,2),O=y[0],E=y[1],S=Object(a.useState)(me),x=Object(o.a)(S,2),N=x[0],w=x[1];function C(){E(!1)}function q(){return(q=Object(Z.a)(z.a.mark((function e(t){var a,r,i;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.player,!(r=a.player.player).getVideoData){e.next=6;break}i=I(r),e.next=10;break;case 6:if(!r.getCurrentSound){e.next=10;break}return e.next=9,k(r);case 9:i=e.sent;case 10:w(Object(s.a)(Object(s.a)({},i),{},{url:n}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){var t=e.getDuration(),n=e.getVideoData(),a=n.title,r=n.video_id;return{duration:t,title:a,artist:n.author,thumbnail:"http://img.youtube.com/vi/".concat(r,"/0.jpg")}}function k(e){return new Promise((function(t){e.getCurrentSound((function(e){e&&t({duration:Number(e.duration/1e3),title:e.title,artist:e.user.username,thumbnail:e.artwork_url.replace("-large","-t500x500")})}))}))}function P(){return(P=Object(Z.a)(z.a.mark((function e(){var t,n,a,r,l;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=N.url,n=N.duration,a=N.title,r=N.artist,l=N.thumbnail,e.next=4,c({variables:{url:t.length>0?t:null,title:a.length>0?a:null,artist:r.length>0?r:null,thumbnail:l.length>0?l:null,duration:n>0?n:null}});case 4:C(),w(me),i(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error adding song",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function _(e){var t,n;return null===m||void 0===m||null===(t=m.graphQLErrors[0])||void 0===t||null===(n=t.extensions)||void 0===n?void 0:n.path.includes(e)}function F(e){var t=e.target,n=t.name,a=t.value;w((function(e){return Object(s.a)(Object(s.a)({},e),{},Object(V.a)({},n,a))}))}Object(a.useEffect)((function(){var e=oe.a.canPlay(n)||ce.a.canPlay(n);f(e)}),[n]);var A=N.title,T=N.artist,G=N.thumbnail;return r.a.createElement("div",{className:h.container},r.a.createElement(H.a,{className:h.dialog,open:O,onClose:C},r.a.createElement(K.a,null,"Edit Song"),r.a.createElement(X.a,null,r.a.createElement("img",{src:G,alt:"Song thumbnail",className:h.thumbnail}),r.a.createElement(ee.a,{onChange:F,margin:"dense",name:"title",label:"Title",value:A,fullWidth:!0,error:_("title"),helperText:_("title")&&"Fill out field"}),r.a.createElement(ee.a,{onChange:F,margin:"dense",name:"artist",label:"Artist",value:T,fullWidth:!0,error:_("artist"),helperText:_("artist")&&"Fill out field"}),r.a.createElement(ee.a,{onChange:F,margin:"dense",name:"thumbnail",label:"Thumbnail",value:G,fullWidth:!0,error:_("thumbnail"),helperText:_("thumbnail")&&"Fill out field"})),r.a.createElement(te.a,null,r.a.createElement(ne.a,{onClick:C,color:"secondary"},"Cancel"),r.a.createElement(ne.a,{variant:"outlined",color:"primary",onClick:function(){return P.apply(this,arguments)}},"Add Song"))),r.a.createElement(ee.a,{className:h.urLInput,onChange:function(e){i(e.target.value)},value:n,placeholder:"Add Youtube or Soundcloud url",fullWidth:!0,margin:"normal",type:"url",InputProps:{startAdornment:r.a.createElement(ae.a,{position:"start"},r.a.createElement(re.a,null))}}),r.a.createElement(ne.a,{disabled:!g,className:h.addSongButton,onClick:function(e){e.preventDefault(),E(!0)},variant:"contained",color:"primary",endIcon:r.a.createElement(ie.a,null)},"Add"),r.a.createElement(Q.a,{url:n,hidden:!0,onReady:function(e){return q.apply(this,arguments)}}))},pe=n(230),ge=r.a.createContext({song:{id:"3561c605-d486-44cb-9bba-d1beeb641778",title:"LUNE",artist:"MOON",thumbnail:"https://picsum.photos/id/237/100/100",duration:250,url:"https://music.youtube.com/watch?v=--ZtUFsIgMk&feature=share"},isPlaying:!1});ge.displayName="SongContext";var be=function(){var e=r.a.useContext(ge),t=r.a.useReducer(T,e),n=Object(o.a)(t,2),a=n[0],i=n[1],l=Object(m.a)((function(e){return e.breakpoints.up("sm")})),u=Object(m.a)((function(e){return e.breakpoints.up("md")}));return r.a.createElement(ge.Provider,{value:{state:a,dispatch:i}},r.a.createElement(pe.a,{container:!0,spacing:3},r.a.createElement(pe.a,{style:{paddingTop:l?80:10},item:!0,xs:12,md:7},r.a.createElement(de,null),r.a.createElement(W,null)),r.a.createElement(pe.a,{style:u?{position:"fixed",width:"100%",top:70,right:0}:{position:"fixed",width:"100%",left:0,bottom:0},item:!0,xs:12,md:5},r.a.createElement($,null))))},fe=n(233),he=n(234),ve=n(125),ye=n(231),Oe=n(232),Ee=Object(ve.a)({palette:{type:"dark",primary:ye.a,secondary:Oe.a}}),je=n(36),Se=n(126);function xe(){var e=Object(f.a)(["\n      query GetQueue {\n        queue\n      }\n    "]);return xe=function(){return e},e}function Ne(){var e=Object(f.a)(["\n    type Song {\n        id: uuid!,\n        title: String!,\n        artist: String!,\n        thumbnail: String!,\n        duration: Float!,\n        ulr: String!\n    }\n\n    input SongInput {\n        id: uuid!,\n        title: String!,\n        artist: String!,\n        thumbnail: String!,\n        duration: Float!,\n        ulr: String!\n    }\n\n    type Query {\n        queue: [Song]!,\n    }\n\n    type Mutation {\n        addOrRemoveFromQueue(input: SongInput): [Song]!\n    }\n    "]);return Ne=function(){return e},e}var we=new b.ApolloClient({link:new Se.a({uri:"wss://welcome-chipmunk-46.hasura.app/v1/graphql",options:{reconnect:!0}}),cache:new b.InMemoryCache,typeDefs:Object(b.gql)(Ne()),resolvers:{Mutation:{addOrRemoveFromQueue:function(e,t,n){var a=t.input,r=n.cache,i=r.readQuery({query:v});if(i){var l=i.queue,o=l.some((function(e){return e.id===a.id}))?l.filter((function(e){return e.id!==a.id})):[].concat(Object(je.a)(l),[a]);return r.writeQuery({query:v,data:{queue:o}}),o}return[]}}}}),Ce=Boolean(localStorage.getItem("queue"));we.writeQuery({query:Object(b.gql)(xe()),data:{queue:Ce?JSON.parse(localStorage.getItem("queue")):[]}});var qe=we;l.a.render(r.a.createElement(b.ApolloProvider,{client:qe},r.a.createElement(r.a.StrictMode,null,r.a.createElement(fe.a,{theme:Ee},r.a.createElement(he.a,null),r.a.createElement(be,null)))),document.getElementById("root"))}},[[137,1,2]]]);
//# sourceMappingURL=main.1c248880.chunk.js.map